# Test the recommendation logic

import pytest
from Service import recommend_utils
from Service import plugin_server

@pytest.fixture(scope='class')
def ip_and_IP():
    extract_ap_epgs = {'ap2': {'epg3': 2, 'epg0': 1, 'epg1': 2, 'epg4': 2}, 'ap0': {'epg2': 2, 'epg0': 1, 'epg1': 2, 'epg4': 1}, 'ap1': {'epg2': 2, 'epg1': 1, 'epg4': 2}}
    common_eps = [{'dn': 'uni/tn-tn0/ap-ap0/epg-epg0', 'IP': '172.18.84.190', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'IP': '172.17.225.127', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'IP': '192.168.63.241', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'IP': '192.168.63.241', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'IP': '192.168.219.150', 'cep_ip': False},
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg4', 'IP': '172.28.111.49', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap1/epg-epg2', 'IP': '10.146.138.195', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'IP': '192.168.63.241', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap1/epg-epg4', 'IP': '10.146.138.195', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap1/epg-epg2', 'IP': '192.168.200.48', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap2/epg-epg0', 'IP': '172.18.84.190', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap1/epg-epg4', 'IP': '10.222.21.16', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap2/epg-epg1', 'IP': '10.180.33.194', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap2/epg-epg3', 'IP': '10.143.247.50', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap2/epg-epg1', 'IP': '172.24.138.103', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap2/epg-epg3', 'IP': '172.17.225.127', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap2/epg-epg4', 'IP': '10.143.247.50', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap2/epg-epg4', 'IP': '10.222.21.16', 'cep_ip': False}]

    apic_data = plugin_server.get_apic_data('tn0')
    
    return extract_ap_epgs, common_eps, apic_data

@pytest.fixture(scope='class')
def cef_ip_and_fvip_data():
    extract_ap_epgs = {'ap2': {'epg3': 2, 'epg0': 1, 'epg1': 2, 'epg4': 2}, 'ap0': {'epg2': 2, 'epg0': 1, 'epg1': 2, 'epg4': 1}, 'ap1': {'epg2': 2, 'epg1': 1, 'epg4': 2}}
    common_eps = [ 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'IP': '192.168.63.241', 'cep_ip': True}, 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'IP': '192.168.63.241', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'IP': '192.168.63.241', 'cep_ip': True}]
     
    apic_data = [{'BD': 'uni/tn-tn0/ap-ap0/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Food.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'e1:18:b7:f8:8d:3e', 'EPG': 'epg1', 'AppProfile': 'ap0', 'hostingServerName': 'hypername3', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-100/eth0/6'], 'epg_health': '85', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'},{'BD': 'uni/tn-tn0/ap-ap0/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Notice.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '36:a4:a8:20:b9:c5', 'EPG': 'epg2', 'AppProfile': 'ap0', 'hostingServerName': 'hypername4', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-103/eth5/6'], 'epg_health': '38', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter106'},{'BD': 'uni/tn-tn0/ap-ap1/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Role.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '52:ad:66:c3:91:32', 'EPG': 'epg1', 'AppProfile': 'ap1', 'hostingServerName': 'hypername13', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-104/eth4/6'], 'epg_health': '31', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter104'}]

    return extract_ap_epgs, common_eps, apic_data

@pytest.fixture(scope='class')    
def vrf_data():
    extract_ap_epgs = {'ap2': {'epg3': 2, 'epg0': 1, 'epg1': 2, 'epg4': 2}, 'ap0': {'epg2': 2, 'epg0': 1, 'epg1': 2, 'epg4': 1}, 'ap1': {'epg2': 2, 'epg1': 1, 'epg4': 2}}
    
    common_eps = [ 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'IP': '192.168.63.241', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'IP': '192.168.63.241', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'IP': '192.168.63.241', 'cep_ip': False}]

    apic_data = [{'BD': 'uni/tn-tn0/ap-ap0/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Upon.', 'IP': '172.19.216.166', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'db:41:39:a1:8b:8d', 'EPG': 'epg0', 'AppProfile': 'ap0', 'hostingServerName': 'hypername0', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-3/Node-100/eth0/6'], 'epg_health': '100', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Southern.', 'IP': '172.18.84.190', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': 'f1:67:bc:34:00:c1', 'EPG': 'epg0', 'AppProfile': 'ap0', 'hostingServerName': 'hypername1', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-101/eth2/6'], 'epg_health': '100', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Prevent.', 'IP': '172.17.225.127', 'VMM-Domain': 'ESX0-leaf103', 'CEP-Mac': '92:c5:13:20:8e:6f', 'EPG': 'epg1', 'AppProfile': 'ap0', 'hostingServerName': 'hypername2', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-1/Node-106/eth2/6'], 'epg_health': '85', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter103'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Food.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'e1:18:b7:f8:8d:3e', 'EPG': 'epg1', 'AppProfile': 'ap0', 'hostingServerName': 'hypername3', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-100/eth0/6'], 'epg_health': '85', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Notice.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '36:a4:a8:20:b9:c5', 'EPG': 'epg2', 'AppProfile': 'ap0', 'hostingServerName': 'hypername4', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-103/eth5/6'], 'epg_health': '38', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Reach.', 'IP': '192.168.219.150', 'VMM-Domain': 'ESX0-leaf100', 'CEP-Mac': 'b7:3a:98:22:5c:ef', 'EPG': 'epg2', 'AppProfile': 'ap0', 'hostingServerName': 'hypername5', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-106/eth0/6'], 'epg_health': '38', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter100'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Check.', 'IP': '172.19.216.166', 'VMM-Domain': 'ESX0-leaf102', 'CEP-Mac': '3b:79:d1:aa:cb:7e', 'EPG': 'epg3', 'AppProfile': 'ap0', 'hostingServerName': 'hypername7', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-106/eth1/6'], 'epg_health': '9', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter102'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'As.', 'IP': '172.28.111.49', 'VMM-Domain': 'ESX0-leaf105', 'CEP-Mac': '45:87:b8:89:1a:49', 'EPG': 'epg4', 'AppProfile': 'ap0', 'hostingServerName': 'hypername9', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-3/Node-102/eth4/6'], 'epg_health': '74', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter105'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Set.', 'IP': '192.168.198.74', 'VMM-Domain': 'ESX0-leaf100', 'CEP-Mac': '5e:c2:e5:73:10:50', 'EPG': 'epg3', 'AppProfile': 'ap0', 'hostingServerName': 'hypername5', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-106/eth5/6'], 'epg_health': '9', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter100'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Season.', 'IP': '10.8.139.228', 'VMM-Domain': 'ESX0-leaf102', 'CEP-Mac': '7f:aa:05:fb:10:1c', 'EPG': 'epg4', 'AppProfile': 'ap0', 'hostingServerName': 'hypername8', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-102/eth2/6'], 'epg_health': '74', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter102'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Say.', 'IP': '10.51.79.90', 'VMM-Domain': 'ESX0-leaf105', 'CEP-Mac': 'ba:38:00:3b:70:33', 'EPG': 'epg1', 'AppProfile': 'ap1', 'hostingServerName': 'hypername12', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-100/eth2/6'], 'epg_health': '31', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter105'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Truth.', 'IP': '192.168.20.233', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '42:56:fc:a0:eb:4b', 'EPG': 'epg0', 'AppProfile': 'ap1', 'hostingServerName': 'hypername10', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-100/eth0/6'], 'epg_health': '38', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Like.', 'IP': '10.146.138.195', 'VMM-Domain': 'ESX0-leaf100', 'CEP-Mac': '63:fb:44:8c:5a:38', 'EPG': 'epg2', 'AppProfile': 'ap1', 'hostingServerName': 'hypername14', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-100/eth0/6'], 'epg_health': '30', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter100'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Role.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '52:ad:66:c3:91:32', 'EPG': 'epg1', 'AppProfile': 'ap1', 'hostingServerName': 'hypername13', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-104/eth4/6'], 'epg_health': '31', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter104'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Discover.', 'IP': '10.8.139.228', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '04:a1:9f:66:90:2e', 'EPG': 'epg0', 'AppProfile': 'ap1', 'hostingServerName': 'hypername11', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-3/Node-100/eth1/6'], 'epg_health': '38', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter104'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Movie.', 'IP': '10.146.138.195', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': '27:6b:7a:c3:49:6e', 'EPG': 'epg4', 'AppProfile': 'ap1', 'hostingServerName': 'hypername18', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-105/eth4/6'], 'epg_health': '18', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Risk.', 'IP': '192.168.200.48', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': '69:33:54:e5:9f:c4', 'EPG': 'epg2', 'AppProfile': 'ap1', 'hostingServerName': 'hypername15', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-2/Node-105/eth6/6'], 'epg_health': '30', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Whose.', 'IP': '172.24.11.169', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '05:03:d4:43:31:bd', 'EPG': 'epg3', 'AppProfile': 'ap1', 'hostingServerName': 'hypername10', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-1/Node-104/eth6/6'], 'epg_health': '86', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Team.', 'IP': '10.51.79.90', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': 'f7:e6:17:54:aa:59', 'EPG': 'epg3', 'AppProfile': 'ap1', 'hostingServerName': 'hypername16', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-2/Node-106/eth1/6'], 'epg_health': '86', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Professor.', 'IP': '172.18.84.190', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': 'b2:45:28:10:e1:52', 'EPG': 'epg0', 'AppProfile': 'ap2', 'hostingServerName': 'hypername20', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-106/eth4/6'], 'epg_health': '92', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter104'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Rich.', 'IP': '10.222.21.16', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '17:2e:f5:92:b7:ca', 'EPG': 'epg4', 'AppProfile': 'ap1', 'hostingServerName': 'hypername19', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-103/eth4/6'], 'epg_health': '18', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter104'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Claim.', 'IP': '10.51.79.90', 'VMM-Domain': 'ESX0-leaf102', 'CEP-Mac': '87:3b:40:41:ea:09', 'EPG': 'epg0', 'AppProfile': 'ap2', 'hostingServerName': 'hypername21', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-2/Node-105/eth1/6'], 'epg_health': '92', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter102'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'These.', 'IP': '10.180.33.194', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'ed:f8:8b:7b:9e:11', 'EPG': 'epg1', 'AppProfile': 'ap2', 'hostingServerName': 'hypername22', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-101/eth3/6'], 'epg_health': '13', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Her.', 'IP': '10.143.247.50', 'VMM-Domain': 'ESX0-leaf100', 'CEP-Mac': '68:a6:63:8c:4c:98', 'EPG': 'epg3', 'AppProfile': 'ap2', 'hostingServerName': 'hypername26', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-104/eth6/6'], 'epg_health': '29', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter100'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Accept.', 'IP': '192.168.26.192', 'VMM-Domain': 'ESX0-leaf102', 'CEP-Mac': '08:52:a5:12:d9:fa', 'EPG': 'epg2', 'AppProfile': 'ap2', 'hostingServerName': 'hypername24', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-102/eth2/6'], 'epg_health': '33', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter102'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Recent.', 'IP': '172.21.49.74', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'f4:03:9b:bb:44:d7', 'EPG': 'epg2', 'AppProfile': 'ap2', 'hostingServerName': 'hypername25', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-101/eth4/6'], 'epg_health': '33', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Senior.', 'IP': '172.24.138.103', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'e2:2b:cd:23:51:a1', 'EPG': 'epg1', 'AppProfile': 'ap2', 'hostingServerName': 'hypername23', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-104/eth6/6'], 'epg_health': '13', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Within.', 'IP': '172.17.225.127', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': '7b:f6:3c:ed:3d:c7', 'EPG': 'epg3', 'AppProfile': 'ap2', 'hostingServerName': 'hypername27', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-3/Node-106/eth2/6'], 'epg_health': '29', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Hundred.', 'IP': '10.143.247.50', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '3a:7d:93:7b:0f:14', 'EPG': 'epg4', 'AppProfile': 'ap2', 'hostingServerName': 'hypername28', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-100/eth0/6'], 'epg_health': '41', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Discover.', 'IP': '10.222.21.16', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '04:4b:8a:19:fd:11', 'EPG': 'epg4', 'AppProfile': 'ap2', 'hostingServerName': 'hypername29', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-1/Node-101/eth2/6'], 'epg_health': '41', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter104'}]

    return extract_ap_epgs, common_eps, apic_data

@pytest.fixture(scope='class')    
def ap_data():
    extract_ap_epgs = {'ap2': {'epg3': 2, 'epg0': 1, 'epg1': 2, 'epg4': 2}, 'ap0': {'epg2': 2, 'epg0': 1, 'epg1': 2, 'epg4': 1}, 'ap1': {'epg2': 2, 'epg1':5, 'epg4': 2}}
    
    common_eps = [ 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'IP': '192.168.63.241', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'IP': '192.168.63.241', 'cep_ip': False}, 
    {'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'IP': '192.168.63.241', 'cep_ip': False}]

    apic_data = [{'BD': 'uni/tn-tn0/ap-ap0/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Upon.', 'IP': '172.19.216.166', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'db:41:39:a1:8b:8d', 'EPG': 'epg0', 'AppProfile': 'ap0', 'hostingServerName': 'hypername0', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-3/Node-100/eth0/6'], 'epg_health': '100', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Southern.', 'IP': '172.18.84.190', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': 'f1:67:bc:34:00:c1', 'EPG': 'epg0', 'AppProfile': 'ap0', 'hostingServerName': 'hypername1', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-101/eth2/6'], 'epg_health': '100', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Prevent.', 'IP': '172.17.225.127', 'VMM-Domain': 'ESX0-leaf103', 'CEP-Mac': '92:c5:13:20:8e:6f', 'EPG': 'epg1', 'AppProfile': 'ap0', 'hostingServerName': 'hypername2', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-1/Node-106/eth2/6'], 'epg_health': '85', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter103'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Food.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'e1:18:b7:f8:8d:3e', 'EPG': 'epg1', 'AppProfile': 'ap0', 'hostingServerName': 'hypername3', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-100/eth0/6'], 'epg_health': '85', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Notice.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '36:a4:a8:20:b9:c5', 'EPG': 'epg2', 'AppProfile': 'ap0', 'hostingServerName': 'hypername4', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-103/eth5/6'], 'epg_health': '38', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Reach.', 'IP': '192.168.219.150', 'VMM-Domain': 'ESX0-leaf100', 'CEP-Mac': 'b7:3a:98:22:5c:ef', 'EPG': 'epg2', 'AppProfile': 'ap0', 'hostingServerName': 'hypername5', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-106/eth0/6'], 'epg_health': '38', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter100'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Check.', 'IP': '172.19.216.166', 'VMM-Domain': 'ESX0-leaf102', 'CEP-Mac': '3b:79:d1:aa:cb:7e', 'EPG': 'epg3', 'AppProfile': 'ap0', 'hostingServerName': 'hypername7', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-106/eth1/6'], 'epg_health': '9', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter102'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'As.', 'IP': '172.28.111.49', 'VMM-Domain': 'ESX0-leaf105', 'CEP-Mac': '45:87:b8:89:1a:49', 'EPG': 'epg4', 'AppProfile': 'ap0', 'hostingServerName': 'hypername9', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-3/Node-102/eth4/6'], 'epg_health': '74', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter105'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Set.', 'IP': '192.168.198.74', 'VMM-Domain': 'ESX0-leaf100', 'CEP-Mac': '5e:c2:e5:73:10:50', 'EPG': 'epg3', 'AppProfile': 'ap0', 'hostingServerName': 'hypername5', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-106/eth5/6'], 'epg_health': '9', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter100'}, {'BD': 'uni/tn-tn0/ap-ap0/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap0/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Season.', 'IP': '10.8.139.228', 'VMM-Domain': 'ESX0-leaf102', 'CEP-Mac': '7f:aa:05:fb:10:1c', 'EPG': 'epg4', 'AppProfile': 'ap0', 'hostingServerName': 'hypername8', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-102/eth2/6'], 'epg_health': '74', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter102'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Say.', 'IP': '10.51.79.90', 'VMM-Domain': 'ESX0-leaf105', 'CEP-Mac': 'ba:38:00:3b:70:33', 'EPG': 'epg1', 'AppProfile': 'ap1', 'hostingServerName': 'hypername12', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-100/eth2/6'], 'epg_health': '31', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter105'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Truth.', 'IP': '192.168.20.233', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '42:56:fc:a0:eb:4b', 'EPG': 'epg0', 'AppProfile': 'ap1', 'hostingServerName': 'hypername10', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-100/eth0/6'], 'epg_health': '38', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Like.', 'IP': '10.146.138.195', 'VMM-Domain': 'ESX0-leaf100', 'CEP-Mac': '63:fb:44:8c:5a:38', 'EPG': 'epg2', 'AppProfile': 'ap1', 'hostingServerName': 'hypername14', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-100/eth0/6'], 'epg_health': '30', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter100'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Role.', 'IP': '192.168.63.241', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '52:ad:66:c3:91:32', 'EPG': 'epg1', 'AppProfile': 'ap1', 'hostingServerName': 'hypername13', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-104/eth4/6'], 'epg_health': '31', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter104'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Discover.', 'IP': '10.8.139.228', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '04:a1:9f:66:90:2e', 'EPG': 'epg0', 'AppProfile': 'ap1', 'hostingServerName': 'hypername11', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-3/Node-100/eth1/6'], 'epg_health': '38', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter104'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Movie.', 'IP': '10.146.138.195', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': '27:6b:7a:c3:49:6e', 'EPG': 'epg4', 'AppProfile': 'ap1', 'hostingServerName': 'hypername18', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-105/eth4/6'], 'epg_health': '18', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Risk.', 'IP': '192.168.200.48', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': '69:33:54:e5:9f:c4', 'EPG': 'epg2', 'AppProfile': 'ap1', 'hostingServerName': 'hypername15', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-2/Node-105/eth6/6'], 'epg_health': '30', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Whose.', 'IP': '172.24.11.169', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '05:03:d4:43:31:bd', 'EPG': 'epg3', 'AppProfile': 'ap1', 'hostingServerName': 'hypername10', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-1/Node-104/eth6/6'], 'epg_health': '86', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Team.', 'IP': '10.51.79.90', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': 'f7:e6:17:54:aa:59', 'EPG': 'epg3', 'AppProfile': 'ap1', 'hostingServerName': 'hypername16', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-2/Node-106/eth1/6'], 'epg_health': '86', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Professor.', 'IP': '172.18.84.190', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': 'b2:45:28:10:e1:52', 'EPG': 'epg0', 'AppProfile': 'ap2', 'hostingServerName': 'hypername20', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-106/eth4/6'], 'epg_health': '92', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter104'}, {'BD': 'uni/tn-tn0/ap-ap1/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap1/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Rich.', 'IP': '10.222.21.16', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '17:2e:f5:92:b7:ca', 'EPG': 'epg4', 'AppProfile': 'ap1', 'hostingServerName': 'hypername19', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-103/eth4/6'], 'epg_health': '18', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter104'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg0', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg0', 'learningSource': 'vmm', 'VM-Name': 'Claim.', 'IP': '10.51.79.90', 'VMM-Domain': 'ESX0-leaf102', 'CEP-Mac': '87:3b:40:41:ea:09', 'EPG': 'epg0', 'AppProfile': 'ap2', 'hostingServerName': 'hypername21', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-2/Node-105/eth1/6'], 'epg_health': '92', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter102'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'These.', 'IP': '10.180.33.194', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'ed:f8:8b:7b:9e:11', 'EPG': 'epg1', 'AppProfile': 'ap2', 'hostingServerName': 'hypername22', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-101/eth3/6'], 'epg_health': '13', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Her.', 'IP': '10.143.247.50', 'VMM-Domain': 'ESX0-leaf100', 'CEP-Mac': '68:a6:63:8c:4c:98', 'EPG': 'epg3', 'AppProfile': 'ap2', 'hostingServerName': 'hypername26', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-104/eth6/6'], 'epg_health': '29', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter100'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Accept.', 'IP': '192.168.26.192', 'VMM-Domain': 'ESX0-leaf102', 'CEP-Mac': '08:52:a5:12:d9:fa', 'EPG': 'epg2', 'AppProfile': 'ap2', 'hostingServerName': 'hypername24', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-5/Node-102/eth2/6'], 'epg_health': '33', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter102'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg2', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg2', 'learningSource': 'vmm', 'VM-Name': 'Recent.', 'IP': '172.21.49.74', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'f4:03:9b:bb:44:d7', 'EPG': 'epg2', 'AppProfile': 'ap2', 'hostingServerName': 'hypername25', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-4/Node-101/eth4/6'], 'epg_health': '33', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg1', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg1', 'learningSource': 'vmm', 'VM-Name': 'Senior.', 'IP': '172.24.138.103', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': 'e2:2b:cd:23:51:a1', 'EPG': 'epg1', 'AppProfile': 'ap2', 'hostingServerName': 'hypername23', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-6/Node-104/eth6/6'], 'epg_health': '13', 'VRF': 'tn0/vrf0', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg3', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg3', 'learningSource': 'vmm', 'VM-Name': 'Within.', 'IP': '172.17.225.127', 'VMM-Domain': 'ESX0-leaf101', 'CEP-Mac': '7b:f6:3c:ed:3d:c7', 'EPG': 'epg3', 'AppProfile': 'ap2', 'hostingServerName': 'hypername27', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-3/Node-106/eth2/6'], 'epg_health': '29', 'VRF': 'tn0/vrf2', 'controllerName': 'vcenter101'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Hundred.', 'IP': '10.143.247.50', 'VMM-Domain': 'ESX0-leaf106', 'CEP-Mac': '3a:7d:93:7b:0f:14', 'EPG': 'epg4', 'AppProfile': 'ap2', 'hostingServerName': 'hypername28', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-0/Node-100/eth0/6'], 'epg_health': '41', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter106'}, {'BD': 'uni/tn-tn0/ap-ap2/epg-epg4', 'dn': 'uni/tn-tn0/ap-ap2/epg-epg4', 'learningSource': 'vmm', 'VM-Name': 'Discover.', 'IP': '10.222.21.16', 'VMM-Domain': 'ESX0-leaf104', 'CEP-Mac': '04:4b:8a:19:fd:11', 'EPG': 'epg4', 'AppProfile': 'ap2', 'hostingServerName': 'hypername29', 'Contracts': {'IntraEpg': ['dummy'], 'Consumer Interface': ['dummy'], 'Consumer': ['dummy'], 'Taboo': ['dummy'], 'Provider': ['dummy']}, 'Interfaces': ['Pod-1/Node-101/eth2/6'], 'epg_health': '41', 'VRF': 'tn0/vrf1', 'controllerName': 'vcenter104'}]

    return extract_ap_epgs, common_eps, apic_data


def test_recommended_eps():
    source_ip_list = []
    parsed_eps = []
    apic_data = []
    assert recommend_utils.recommended_eps(source_ip_list, parsed_eps, apic_data) == []

def test_determine_recommnedation_with_IP(ip_and_IP):
    source_ip_list, parsed_eps, apic_data = ip_and_IP
    assert recommend_utils.determine_recommendation(source_ip_list, parsed_eps, apic_data) == [['10.143.247.50', 'uni/tn-tn0/ap-ap2/epg-epg4', 'No', 'IP'], ['10.143.247.50', 'uni/tn-tn0/ap-ap2/epg-epg3', 'Yes', 'IP'], ['10.146.138.195', 'uni/tn-tn0/ap-ap1/epg-epg2', 'Yes', 'IP'], ['10.146.138.195', 'uni/tn-tn0/ap-ap1/epg-epg4', 'Yes', 'IP'], ['10.180.33.194', 'uni/tn-tn0/ap-ap2/epg-epg1', 'Yes', 'IP'], ['10.222.21.16', 'uni/tn-tn0/ap-ap1/epg-epg4', 'No', 'IP'], ['10.222.21.16', 'uni/tn-tn0/ap-ap2/epg-epg4', 'Yes', 'IP'], ['172.17.225.127', 'uni/tn-tn0/ap-ap0/epg-epg1', 'No', 'IP'], ['172.17.225.127', 'uni/tn-tn0/ap-ap2/epg-epg3', 'Yes', 'IP'], ['172.18.84.190', 'uni/tn-tn0/ap-ap0/epg-epg0', 'No', 'IP'], ['172.18.84.190', 'uni/tn-tn0/ap-ap2/epg-epg0', 'Yes', 'IP'], ['172.24.138.103', 'uni/tn-tn0/ap-ap2/epg-epg1', 'Yes', 'IP'], ['172.28.111.49', 'uni/tn-tn0/ap-ap0/epg-epg4', 'Yes', 'IP'], ['192.168.200.48', 'uni/tn-tn0/ap-ap1/epg-epg2', 'Yes', 'IP'], ['192.168.219.150', 'uni/tn-tn0/ap-ap0/epg-epg2', 'Yes', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap0/epg-epg1', 'No', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap1/epg-epg1', 'No', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap0/epg-epg2', 'Yes', 'IP']]

def test_determine_recommendation_CEF_FVIP(cef_ip_and_fvip_data):
    source_ip_list, parsed_eps, apic_data = cef_ip_and_fvip_data
    recommend_utils.recommended_eps(source_ip_list, parsed_eps, apic_data) == [['192.168.63.241', 'uni/tn-tn0/ap-ap0/epg-epg1', 'No', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap1/epg-epg1', 'No', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap0/epg-epg2', 'Yes', 'IP']]

def test_determine_recommendation_VRF(vrf_data):
    source_ip_list, parsed_eps, apic_data = vrf_data
    recommend_utils.recommended_eps(source_ip_list, parsed_eps, apic_data) == [['192.168.63.241', 'uni/tn-tn0/ap-ap0/epg-epg1', 'No', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap1/epg-epg1', 'No', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap0/epg-epg2', 'Yes', 'IP']]

def test_determine_recommendation_ap(ap_data):
    source_ip_list, parsed_eps, apic_data = ap_data
    recommend_utils.recommended_eps(source_ip_list, parsed_eps, apic_data) == [['192.168.63.241', 'uni/tn-tn0/ap-ap0/epg-epg1', 'No', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap1/epg-epg1', 'Yes', 'IP'], ['192.168.63.241', 'uni/tn-tn0/ap-ap0/epg-epg2', 'No', 'IP']]


